@()(implicit user: com.gu.googleauth.UserIdentity)

@main {

  <div class="page-header">
    <h1>User guide</h1>
  </div>

  <h2>How to notify :shipit: of a deployment</h2>

  <p>You can tell :shipit: about your deployment by sending a POST request to its HTTP API.</p>

  <h3>Send an HTTP POST</h3>

  <p>First you will need an API key, if you don't have one already. Click on "API keys" in the navbar and create one.</p>

  <p>You will need to include at least three fields in your POST: <code>team</code>, <code>service</code> and <code>buildId</code>.</p>

  <p>Hopefully the first two are self-explanatory. <code>buildId</code> could be e.g. the build number generated by your CI tool.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovotech.org.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123</pre>

  <p>You can also include links and/or a short note if you want to. These will be displayed in the UI and also included in the Slack notification.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovotech.org.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d 'links[0].title=CircleCI build' \
    -d 'links[0].url=https://circleci.com/gh/ovotech/comms-gateway-event-manager/123' \
    -d 'links[1].title=Pull request' \
    -d 'links[1].url=https://github.com/ovotech/comms-gateway-event-manager/pull/42' \
    -d 'note=Build started by Chris'</pre>

  <p>If you want to create a JIRA ticket for the release, include a <code>jiraComponent</code> field containing the name of the appropriate JIRA component for the deployment.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovotech.org.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d 'jiraComponent=Comms Platform'</pre>

  <p>:shipit: will always send a notification to the #announce_change Slack channel. You can also notify a custom channel if you want to. To do so, include a <code>notifySlackChannel</code> field in your POST.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovotech.org.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d notifySlackChannel=comms-deployments</pre>

  <p>Finally, you can also notify :shipit: about failed or cancelled builds:</p>

  <pre>$ curl https://shipit.ovotech.org.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d result=failed</pre>

  <p>For a real-world example, take a look at <a href="https://github.com/ovotech/comms-ci-scripts/blob/master/notify_shipit.sh" target="_blank">the script the comms team use in CircleCI</a>.</p>

}
