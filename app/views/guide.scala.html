@()(implicit user: com.gu.googleauth.UserIdentity)

@main {

  <div class="page-header">
    <h1>User guide</h1>
  </div>

  <h2>How to notify :shipit: of a deployment</h2>

  <p>You can do this in two ways: send an HTTP POST or a Kafka event, whichever you prefer.</p>

  <h3>Send an HTTP POST</h3>

  <p>First you will need an API key, if you don't have one already. Click on "API keys" in the navbar and create one.</p>

  <p>You will need to include at least three fields in your POST: <code>team</code>, <code>service</code> and <code>buildId</code>.</p>

  <p>Hopefully the first two are self-explanatory. <code>buildId</code> could be e.g. the build number generated by your CI tool.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovo-comms.co.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123</pre>

  <p>You can also include links if you want to. These will be displayed in the UI and also included in the Slack notification.</p>

  <p>For example:</p>

  <pre>$ curl https://shipit.ovo-comms.co.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d 'links[0].title=CircleCI build' \
    -d 'links[0].url=https://circleci.com/gh/ovotech/comms-gateway-event-manager/123' \
    -d 'links[1].title=Pull request' \
    -d 'links[1].url=https://github.com/ovotech/comms-gateway-event-manager/pull/42'</pre>

  <p>Finally, you can also notify :shipit: about failed or cancelled builds:</p>

  <pre>$ curl https://shipit.ovo-comms.co.uk/deployments?apikey=[your-key-here] \
    -d team=comms \
    -d service=gateway-event-manager \
    -d buildId=123 \
    -d result=failed</pre>

  <h3>Send a Kafka event</h3>

  <p>You can also notify by sending a JSON-encoded Kafka message to the <code>shipit.deployments</code> topic.</p>

  <p>Your JSON object must include at least three fields: <code>team</code>, <code>service</code> and <code>buildId</code>.</p>

  <p>For example:</p>

  <pre>{
  "team": "comms",
  "service": "gateway-event-manager",
  "buildId": "123"
}</pre>

  <p>Just like for the HTTP POST, you can also include an optional list of links and a deployment result:</p>

  <pre>{
  "team": "comms",
  "service": "gateway-event-manager",
  "buildId": "123",
  "links": [{
    "title": "CircleCI build",
    "url": "https://circleci.com/gh/ovotech/comms-gateway-event-manager/123"
  }, {
    "title": "Pull request",
    "url": "https://github.com/ovotech/comms-gateway-event-manager/pull/42"
  }],
  "result": "failed"
}</pre>

}
